<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Smartcity - Building Map</title>

    <style>
        html,
        body,
        #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        #back {
            position: absolute;
            bottom: 20px;
        }

        #back i {
            background-image: url(app/public/img/back.svg);
            background-repeat: no-repeat;
            display: inline-block;
            width: 100px;
            height: 25px;
            padding-left: 25px;
            padding-top: 2px;
            margin: 10px;
            cursor: pointer;
            background-size: 20px;
        }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.16/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.16/"></script>

    <script>
        require([
            "esri/Map",
            "esri/views/SceneView",
            "esri/layers/GeoJSONLayer",
            "esri/layers/SceneLayer",
            "esri/layers/GraphicsLayer",
            "esri/Graphic",
            "esri/request",
        ], function (
            Map,
            SceneView,
            GeoJSONLayer,
            SceneLayer,
            GraphicsLayer,
            Graphic,
            esriRequest
        ) {
            
            const DrawGeo = (url, size, color) => {
                const geojsonLayer = new GeoJSONLayer({
                    url: url,
                });
                geojsonLayer.renderer = {
                    type: "simple",
                    symbol: {
                        type: "polygon-3d",
                        symbolLayers: [{
                            type: "extrude",
                            size: size,
                            material: {
                                color: color,
                            },
                        }],
                    },
                };
                return geojsonLayer;
            }
            

            let layers = [];
            layers.push(DrawGeo("./data/data3dnen.geojson", 1.1, "#E7AD9F"));
            layers.push(DrawGeo("./data/data3dcot.geojson", 12.5, "#E7AD9F"));
            layers.push(DrawGeo("./data/data3dtrangtri.geojson", 0.9, "#E7AD9F"));
            layers.push(DrawGeo("./data/data3drout.geojson", 14, "#E7AD9F"));
            layers.push(DrawGeo("./data/data3dbacthem.geojson", 2, "#435a64"));
            layers.push(DrawGeo("./data/data3dhangrao.geojson", 1, "rgba(0, 0, 0,0.3)"));
            layers.push(DrawGeo("./data/data3dcua.geojson", 3, "#7b4a35"));
            layers.push(DrawGeo("./data/data3dcuaso.geojson", 1.5, "#7b4a35"));
            //layers.push(DrawGeo("./data/data3dmai.geojson", 0.1, "#fda265"));
            //layers.push(DrawGeo("./data/data3dmainhon.geojson", 3, "#fda265"));
            layers.push(DrawGeo("./data/data3dtrangtricot.geojson", 0.2, "#ffffff"));
            layers.push(DrawGeo("./data/data3dlotnen.geojson", 1.15, "rgb(222, 222, 222)"));
            layers.push(DrawGeo("./data/data3dlotmai.geojson", 1.15, "#fda265"));


            var createGraphic = function(data) {
    			return new Graphic({
    				geometry : data,
    				symbol : data.symbol,
    				attributes : data,
    				popupTemplate : data.popupTemplate
    			});
    		};
    		
    		const json_options = {
    				query : {
    					f : "json"
    				},
    				responseType : "json"
    			};
			// request json
			esriRequest('./data/data3dVienMaiNha.json', json_options).then(function(response) {
				var graphicsLayer = new GraphicsLayer();
				response.data.forEach(function(data){
					graphicsLayer.add(createGraphic(data));
				});
				map.add(graphicsLayer);
			});

            const map = new Map({
                basemap: "topo-vector",
                ground: "world-elevation",
                layers: layers, //end layers
            });

            const view = new SceneView({
                container: "viewDiv",
                map: map,
                camera: {
                    position: [106.70680940151215, 10.766974818494525, 100],
                    heading: 0,
                    tilt: 60,
                },
            });

            view.popup.defaultPopupTemplateEnabled = true;
        });
    </script>
</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>